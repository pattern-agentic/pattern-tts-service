# Pattern TTS Helm Chart - Default Values

image:
  repository: 643681787675.dkr.ecr.us-west-2.amazonaws.com/pattern-tts-service
  tag: ""  # Required
  pullPolicy: IfNotPresent

paDeploy:
  env: dev  # REQUIRED

vault:
  agentInject: "true"
  agentPrePopulateOnly: "false"
  roleWithoutEnvPrefix: "pa-cluster-service-pattern-agentic-pattern-tts-service"
  secretWithoutEnvPrefix: "pa-cluster/services/pattern-tts-service"

serviceAccount:
  create: true
  name: pattern-tts-service
  automount: true
  annotations: {}

config:
  API_TITLE: Pattern TTS Service
  API_DESCRIPTION: OpenAI-compatible Text-to-Speech API using Kokoro TTS
  LOG_LEVEL: INFO
  USE_GPU: false
  DOT_ENV: /vault/secrets/service
  MODEL_DIR: /app/models/v1_0
  VOICES_DIR: /app/voices/v1_0
  DEFAULT_VOICE: af_heart
  SAMPLE_RATE: 24000
  TARGET_MIN_TOKENS: 175
  TARGET_MAX_TOKENS: 250
  ABSOLUTE_MAX_TOKENS: 450
  ADVANCED_TEXT_NORMALIZATION: true
  VOICE_WEIGHT_NORMALIZATION: true
  GAP_TRIM_MS: 1
  DYNAMIC_GAP_TRIM_PADDING_MS: 410
  DYNAMIC_GAP_TRIM_PADDING_CHAR_MULTIPLIER: '{".": 1.0, "!": 0.9, "?": 1.0, ",": 0.8}'
  CORS_ORIGINS: '["*"]'
  CORS_ENABLED: true
  DOWNLOAD_MODEL: true

# Global settings
global:
  namespace: pattern-agentic

# Pattern TTS Service
tts:
  enabled: true
  replicas: 2
  resources:
    requests:
      cpu: "2000m"
      memory: "4Gi"
    limits:
      cpu: "4000m"
      memory: "8Gi"

  service:
    name: pattern-tts-service
    type: ClusterIP
    port: 80
    targetPort: 8205

  modelSource:
    type: local

  healthCheck:
    enabled: true
    path: /health
    initialDelaySeconds: 30
    periodSeconds: 10
    timeoutSeconds: 5
    successThreshold: 1
    failureThreshold: 3

  readinessCheck:
    enabled: true
    path: /health
    initialDelaySeconds: 10
    periodSeconds: 5
    timeoutSeconds: 3
    successThreshold: 1
    failureThreshold: 3

# Horizontal Pod Autoscaler
autoscaling:
  enabled: true
  minReplicas: 2
  maxReplicas: 8
  targetCPUUtilizationPercentage: 70
  targetMemoryUtilizationPercentage: 80

# Persistent Volume for Kokoro Models
persistence:
  enabled: true
  size: 20Gi
  storageClass: gp3-xfs
  accessMode: ReadWriteOnce
  volumeName: ""
  modelDownload:
    enabled: true
    source: "https://github.com/hexgrad/kokoro/releases/download/v1.0"
    models:
      - kokoro-v0_19.pth
      - voices.json

# Secrets (AWS Secrets Manager CSI Driver)
secrets:
  enabled: false
  provider: aws-secrets-manager
  region: us-west-2

# Pod Security Context
podSecurityContext:
  runAsNonRoot: true
  runAsUser: 1000
  fsGroup: 1000
  seccompProfile:
    type: RuntimeDefault

# Container Security Context
securityContext:
  allowPrivilegeEscalation: false
  capabilities:
    drop:
      - ALL
  readOnlyRootFilesystem: true

# Network Policies
networkPolicy:
  enabled: false
  policyTypes:
    - Ingress
    - Egress
  ingress:
    - from:
      - podSelector: {}
  egress:
    - to:
      - podSelector: {}

# Service Monitor (Prometheus Operator)
serviceMonitor:
  enabled: false
  interval: 30s
  scrapeTimeout: 10s
  labels: {}

# Ingress
ingress:
  enabled: false
  className: "nginx"
  annotations: {}
  hosts:
    - host: tts.pattern-agentic.example.com
      paths:
        - path: /
          pathType: Prefix
  tls: []
